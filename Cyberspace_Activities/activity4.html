<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ“¡ Mission Control</title>
<style>
  * { margin:0; padding:0; box-sizing:border-box; }

  body {
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(180deg, #020b18 0%, #041225 50%, #020b18 100%);
    min-height: 100vh;
    color: #a8e6cf;
    overflow-x: hidden;
  }

  /* Stars BG */
  .starfield {
    position:fixed; inset:0; pointer-events:none; z-index:0;
    overflow:hidden;
  }
  .star {
    position:absolute; background:white; border-radius:50%;
    animation: twinkle linear infinite;
  }
  @keyframes twinkle {
    0%,100%{opacity:0.2} 50%{opacity:0.9}
  }

  /* â”€â”€ HEADER â”€â”€ */
  .header {
    position:relative; z-index:10;
    background:rgba(0,0,0,0.7);
    border-bottom:1px solid rgba(46,204,113,0.3);
    padding:12px 24px;
    display:flex; align-items:center; justify-content:space-between;
  }
  .header-left { display:flex; align-items:center; gap:12px; }
  .back-btn { color:#555; text-decoration:none; font-size:0.85rem; transition:color 0.2s; }
  .back-btn:hover { color:#2ecc71; }
  .header-title { font-size:1rem; font-weight:800; color:white; }
  .header-stats { display:flex; gap:20px; }
  .hstat { text-align:center; }
  .hstat-val { font-size:1.1rem; font-weight:800; color:white; display:block; }
  .hstat-label { font-size:0.7rem; color:#555; }

  /* Signal meter */
  .signal-row {
    display:flex; align-items:center; gap:10px;
  }
  .signal-label { font-size:0.7rem; color:#555; white-space:nowrap; }
  .signal-track {
    width:100px; height:8px;
    background:rgba(0,0,0,0.5);
    border-radius:4px; overflow:hidden;
    border:1px solid rgba(46,204,113,0.3);
  }
  .signal-fill {
    height:100%; border-radius:4px;
    background:linear-gradient(90deg, #1a8a4a, #2ecc71);
    transition:width 0.6s ease;
    width:0%;
  }

  /* â”€â”€ WELCOME â”€â”€ */
  .welcome-overlay {
    position:fixed; inset:0;
    background:rgba(0,0,0,0.95);
    display:flex; align-items:center; justify-content:center;
    z-index:1000;
  }
  .welcome-card {
    background:#041225;
    border:1px solid rgba(46,204,113,0.4);
    border-radius:24px;
    padding:48px 44px; max-width:540px; width:90%;
    text-align:center;
    animation:popIn 0.4s ease;
  }
  @keyframes popIn { from{opacity:0;transform:scale(0.85)} to{opacity:1;transform:scale(1)} }
  .welcome-icon { font-size:4rem; margin-bottom:16px; }
  .welcome-card h2 { font-size:2rem; color:white; margin-bottom:10px; }
  .welcome-card .sub { color:#667; line-height:1.7; margin-bottom:28px; font-size:0.95rem; }
  .welcome-list {
    text-align:left;
    background:rgba(46,204,113,0.06);
    border:1px solid rgba(46,204,113,0.2);
    border-radius:12px;
    padding:18px 22px; margin-bottom:28px;
    font-size:0.88rem; color:#88c; list-style:none;
    display:flex; flex-direction:column; gap:9px;
  }
  .welcome-list li::before { content:'ğŸ“¡ '; }
  .start-btn {
    background:linear-gradient(135deg, #1a8a4a, #2ecc71);
    border:none; color:white; font-size:1rem; font-weight:700;
    padding:14px 44px; border-radius:50px; cursor:pointer; transition:all 0.2s;
  }
  .start-btn:hover { transform:scale(1.05); }

  /* â”€â”€ MAIN â”€â”€ */
  .main {
    position:relative; z-index:1;
    max-width:900px; margin:0 auto; padding:28px 20px;
  }

  /* Mission briefing */
  .mission-num {
    font-size:0.72rem; text-transform:uppercase; letter-spacing:2px;
    color:#555; text-align:center; margin-bottom:10px;
  }
  .briefing-card {
    background:rgba(0,0,0,0.6);
    border:1px solid rgba(46,204,113,0.3);
    border-radius:16px;
    padding:24px 28px;
    margin-bottom:28px;
    text-align:center;
    animation:briefingSlide 0.5s cubic-bezier(0.34,1.56,0.64,1);
  }
  @keyframes briefingSlide { from{opacity:0;transform:translateY(-20px)} to{opacity:1;transform:translateY(0)} }
  .mission-icon { font-size:3rem; margin-bottom:12px; display:block; }
  .mission-title { font-size:1rem; font-weight:700; letter-spacing:1.5px; color:#2ecc71; margin-bottom:8px; }
  .mission-text { font-size:1.15rem; font-weight:600; color:white; line-height:1.5; }

  /* CITY MAP */
  .map-section {
    background:rgba(0,0,0,0.5);
    border:1px solid rgba(46,204,113,0.2);
    border-radius:16px;
    padding:24px;
    margin-bottom:24px;
    position:relative;
    overflow:hidden;
  }
  .map-label { font-size:0.7rem; text-transform:uppercase; letter-spacing:1.5px; color:#555; margin-bottom:16px; text-align:center; }

  /* Routes */
  .routes {
    display:grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap:14px;
    position:relative;
    z-index:2;
  }
  .route-btn {
    background:rgba(255,255,255,0.03);
    border-radius:14px;
    padding:20px 14px;
    text-align:center;
    cursor:pointer;
    transition:all 0.25s;
    position:relative;
    overflow:hidden;
    border:2px solid transparent;
  }
  .route-btn.http { border-color:rgba(52,152,219,0.4); }
  .route-btn.https { border-color:rgba(46,204,113,0.4); }
  .route-btn.ftp { border-color:rgba(0,217,255,0.4); }
  .route-btn:hover { transform:translateY(-4px); }
  .route-btn.http:hover { background:rgba(52,152,219,0.1); border-color:rgba(52,152,219,0.8); }
  .route-btn.https:hover { background:rgba(46,204,113,0.1); border-color:rgba(46,204,113,0.8); }
  .route-btn.ftp:hover { background:rgba(0,217,255,0.1); border-color:rgba(0,217,255,0.8); }
  .route-btn:disabled { pointer-events:none; }
  .route-btn.correct-route { animation:routeCorrect 0.6s ease; }
  .route-btn.wrong-route { animation:routeWrong 0.4s ease; }
  @keyframes routeCorrect { 0%{transform:scale(1)} 40%{transform:scale(1.06)} 100%{transform:scale(1)} }
  @keyframes routeWrong { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-8px)} 75%{transform:translateX(8px)} }

  .route-icon { font-size:2.5rem; display:block; margin-bottom:8px; }
  .route-name { font-size:0.95rem; font-weight:800; margin-bottom:4px; }
  .route-name.http { color:#3498db; }
  .route-name.https { color:#2ecc71; }
  .route-name.ftp { color:#00d9ff; }
  .route-tag { font-size:0.7rem; color:#555; }

  /* Route glow roads */
  .route-road {
    position:absolute; bottom:0; left:50%; transform:translateX(-50%);
    width:3px; height:30px;
    background:var(--col);
    opacity:0.4;
    border-radius:2px;
  }

  /* PACKET ANIMATION */
  .packet-layer {
    position:absolute; top:0; left:0; right:0; bottom:0;
    pointer-events:none; z-index:5;
  }
  .data-packet {
    position:absolute;
    font-size:1.4rem;
    animation:packetFly 1.2s ease forwards;
  }
  @keyframes packetFly {
    0% { opacity:1; transform:translate(-50%, -50%) scale(1); }
    50% { transform:translate(-50%, calc(-50% - 40px)) scale(1.3); }
    100% { opacity:0; transform:translate(-50%, calc(-50% - 80px)) scale(0.5); }
  }

  /* INTERCEPTED overlay */
  .intercepted-overlay {
    position:absolute; inset:0;
    background:rgba(248,81,73,0.15);
    display:flex; align-items:center; justify-content:center;
    border-radius:14px;
    animation:flashOverlay 0.5s ease;
    pointer-events:none; z-index:10;
  }
  @keyframes flashOverlay { 0%{opacity:1} 100%{opacity:0} }
  .intercepted-text {
    font-size:1.5rem; font-weight:800; color:#f85149;
    animation:popIn 0.3s ease;
  }

  /* â”€â”€ FEEDBACK â”€â”€ */
  .feedback-panel {
    background:rgba(0,0,0,0.5);
    border-radius:14px;
    padding:18px 22px;
    display:none;
    margin-bottom:18px;
    animation:fadeUp 0.3s ease;
  }
  .feedback-panel.visible { display:block; }
  .feedback-panel.correct { border:1px solid #2ecc71; }
  .feedback-panel.wrong { border:1px solid #f85149; }
  @keyframes fadeUp { from{opacity:0;transform:translateY(8px)} to{opacity:1;transform:translateY(0)} }
  .fp-title { font-size:0.95rem; font-weight:700; margin-bottom:8px; }
  .feedback-panel.correct .fp-title { color:#2ecc71; }
  .feedback-panel.wrong .fp-title { color:#f85149; }
  .fp-text { font-size:0.83rem; color:#778; line-height:1.6; }
  .fp-text strong { color:#a8e6cf; }
  .exam-chip {
    display:inline-block; margin-top:10px;
    background:rgba(46,204,113,0.1);
    border:1px solid rgba(46,204,113,0.3);
    border-radius:8px;
    padding:8px 12px;
    font-size:0.78rem; color:#2ecc71; line-height:1.5;
  }

  .next-mission-btn {
    width:100%; padding:14px;
    background:linear-gradient(135deg, #1a8a4a, #2ecc71);
    border:none; border-radius:12px;
    color:white; font-size:0.95rem; font-weight:700;
    cursor:pointer; display:none; transition:all 0.2s;
  }
  .next-mission-btn.visible { display:block; animation:fadeUp 0.3s ease; }
  .next-mission-btn:hover { filter:brightness(1.1); transform:translateY(-2px); }

  /* â”€â”€ RESULTS â”€â”€ */
  .results-overlay {
    position:fixed; inset:0;
    background:rgba(0,0,0,0.95);
    display:none; align-items:center; justify-content:center;
    z-index:1000;
  }
  .results-overlay.visible { display:flex; }
  .results-card {
    background:#041225;
    border:1px solid rgba(46,204,113,0.4);
    border-radius:24px;
    padding:48px 44px; max-width:560px; width:90%;
    text-align:center;
    animation:popIn 0.5s ease;
  }
  .rank-icon { font-size:4.5rem; margin-bottom:12px; }
  .rank-name { font-size:1rem; font-weight:700; letter-spacing:2px; color:#2ecc71; margin-bottom:6px; }
  .res-score { font-size:3.5rem; font-weight:800; color:white; margin-bottom:8px; }
  .res-score span { font-size:1.2rem; color:#555; }
  .res-sub { color:#667; margin-bottom:28px; font-size:0.9rem; line-height:1.6; }
  .protocol-summary {
    display:grid; grid-template-columns:1fr 1fr 1fr;
    gap:12px; margin-bottom:28px;
  }
  .proto-item {
    background:rgba(255,255,255,0.04);
    border-radius:10px;
    padding:14px 8px;
    text-align:center;
  }
  .proto-icon { font-size:1.6rem; display:block; margin-bottom:6px; }
  .proto-name { font-size:0.8rem; font-weight:700; color:white; margin-bottom:4px; }
  .proto-def { font-size:0.72rem; color:#667; line-height:1.4; }
  .res-btns { display:flex; gap:12px; justify-content:center; }
  .res-btn {
    padding:13px 32px; border-radius:50px;
    font-size:0.9rem; font-weight:700; cursor:pointer; border:none; transition:all 0.2s;
  }
  .res-btn.primary { background:linear-gradient(135deg, #1a8a4a, #2ecc71); color:white; }
  .res-btn.secondary { background:rgba(255,255,255,0.06); color:#a8e6cf; border:1px solid rgba(255,255,255,0.1); }
  .res-btn:hover { transform:scale(1.05); }

  /* Hacker swoop */
  .hacker-swoop {
    position:fixed; font-size:2rem; pointer-events:none; z-index:999;
    animation:hackerSwoop 0.8s ease forwards;
  }
  @keyframes hackerSwoop {
    0% { transform:translate(-80px,-80px) rotate(-30deg) scale(1.5); opacity:1; }
    100% { transform:translate(60px, 40px) rotate(15deg) scale(0.8); opacity:0; }
  }

  /* float score */
  .float-score {
    position:fixed; font-size:1.3rem; font-weight:800;
    pointer-events:none; z-index:999;
    animation:floatUp 1s ease forwards;
  }
  @keyframes floatUp { 0%{opacity:1;transform:translateY(0)} 100%{opacity:0;transform:translateY(-60px)} }

  /* combo flash */
  .combo-flash {
    position:fixed; top:50%; left:50%; transform:translate(-50%,-50%);
    font-size:1.8rem; font-weight:800; color:#e3b341;
    pointer-events:none; z-index:999;
    animation:comboAnim 1s ease forwards;
  }
  @keyframes comboAnim { 0%{opacity:0;transform:translate(-50%,-50%) scale(0.5)} 30%{opacity:1;transform:translate(-50%,-50%) scale(1.2)} 70%{opacity:1} 100%{opacity:0;transform:translate(-50%,-50%) scale(1)} }

  @media(max-width:600px) {
    .routes { grid-template-columns:1fr; gap:10px; }
    .protocol-summary { grid-template-columns:1fr; }
    .main { padding:16px 12px; }
  }
</style>
</head>
<body>

<div class="starfield" id="starfield"></div>

<!-- WELCOME -->
<div class="welcome-overlay" id="welcomeOverlay">
  <div class="welcome-card">
    <div class="welcome-icon">ğŸ“¡</div>
    <h2>Mission Control</h2>
    <p class="sub">Data packages need to reach their destinations. Choose the right protocol for each mission â€” or watch your data get intercepted by a hacker lurking in the network.</p>
    <ul class="welcome-list">
      <li>Read each mission briefing carefully</li>
      <li>Choose the correct protocol route: HTTP, HTTPS or FTP</li>
      <li>Wrong choice = data intercepted! ğŸ‘¾</li>
      <li>9 missions across 3 protocol types</li>
    </ul>
    <button class="start-btn" onclick="startGame()">ğŸš€ Begin Missions</button>
  </div>
</div>

<!-- RESULTS -->
<div class="results-overlay" id="resultsOverlay">
  <div class="results-card">
    <div class="rank-icon" id="rankIcon">ğŸ“¡</div>
    <div class="rank-name" id="rankName">COMMS DIRECTOR</div>
    <div class="res-score" id="resScore">0 <span>pts</span></div>
    <div class="res-sub" id="resSub"></div>
    <div class="protocol-summary">
      <div class="proto-item">
        <span class="proto-icon">ğŸŒ</span>
        <div class="proto-name" style="color:#3498db">HTTP</div>
        <div class="proto-def">Transfers web pages across the internet. No encryption â€” not suitable for sensitive data.</div>
      </div>
      <div class="proto-item">
        <span class="proto-icon">ğŸ”’</span>
        <div class="proto-name" style="color:#2ecc71">HTTPS</div>
        <div class="proto-def">Secure web transfer using SSL encryption. Used for banking, logins and personal data.</div>
      </div>
      <div class="proto-item">
        <span class="proto-icon">ğŸ“</span>
        <div class="proto-name" style="color:#00d9ff">FTP</div>
        <div class="proto-def">File Transfer Protocol â€” used to upload and download files over the internet.</div>
      </div>
    </div>
    <div class="res-btns">
      <button class="res-btn primary" onclick="restartGame()">ğŸ”„ Try Again</button>
      <button class="res-btn secondary" onclick="window.location.href='index.html'">â† Menu</button>
    </div>
  </div>
</div>

<!-- HEADER -->
<div class="header">
  <div class="header-left">
    <a href="index.html" class="back-btn">â† Menu</a>
    <div class="header-title">ğŸ“¡ Mission Control</div>
  </div>
  <div class="header-stats">
    <div class="hstat"><span class="hstat-val" id="scoreDisplay">0</span><span class="hstat-label">Score</span></div>
    <div class="hstat"><span class="hstat-val" id="missionDisplay">1/9</span><span class="hstat-label">Mission</span></div>
    <div class="signal-row">
      <span class="signal-label">ğŸ“¶ Signal</span>
      <div class="signal-track"><div class="signal-fill" id="signalFill"></div></div>
    </div>
  </div>
</div>

<div class="main">

  <div class="mission-num">MISSION <span id="missionNum">01</span> OF 09</div>

  <div class="briefing-card" id="briefingCard">
    <span class="mission-icon" id="missionIcon">ğŸ“¦</span>
    <div class="mission-title">INCOMING TRANSMISSION</div>
    <div class="mission-text" id="missionText">Loading mission briefing...</div>
  </div>

  <div class="map-section" id="mapSection">
    <div class="map-label">ğŸ—ºï¸ Select the correct protocol route</div>
    <div class="routes" id="routeGrid"></div>
    <div class="packet-layer" id="packetLayer"></div>
  </div>

  <div class="feedback-panel" id="feedbackPanel">
    <div class="fp-title" id="fpTitle">âœ… Packet delivered!</div>
    <div class="fp-text" id="fpText"></div>
  </div>

  <button class="next-mission-btn" id="nextMissionBtn" onclick="nextMission()">Next Mission â†’</button>

</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  MISSION DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const missions = [
  // HTTP missions
  {
    icon:'ğŸ“°', text:'Load the BBC News homepage to read today\'s headlines.',
    answer:'http',
    fb:'<strong>HTTP</strong> â€” Hypertext Transfer Protocol â€” is used to transfer web pages across the internet. This is a standard news page with no personal data, so HTTP is appropriate.',
    exam:'Protocol = HTTP [1] / Used to transfer web pages across the internet [1]'
  },
  {
    icon:'ğŸ«', text:'Browse the school\'s public information website to check term dates.',
    answer:'http',
    fb:'<strong>HTTP</strong> is correct for loading a standard, public-facing webpage. The school\'s term dates contain no personal or sensitive information.',
    exam:'HTTP [1] / Used to transfer web pages across the internet [1] / Do not accept answers relating to secure transfer [1]'
  },
  {
    icon:'ğŸ“–', text:'Search Wikipedia for information on the history of the internet.',
    answer:'http',
    fb:'<strong>HTTP</strong> transfers standard web pages. Wikipedia is a public resource with no personal data â€” HTTP is appropriate and will send the request to the web server and report errors if the page isn\'t found (e.g. 404).',
    exam:'HTTP [1] / Used to transfer web pages across the internet [1]'
  },
  // HTTPS missions
  {
    icon:'ğŸ¦', text:'Complete a PayPal transaction to purchase revision guides online.',
    answer:'https',
    fb:'<strong>HTTPS</strong> â€” Hypertext Transfer Protocol Secure â€” is essential here! It uses SSL encryption to protect financial data in transit, stopping it being intercepted or stolen. Your browser shows a padlock icon.',
    exam:'HTTPS [1] / Hypertext Transfer Protocol Secure [1] / uses SSL encryption [1] / used for financial transactions / data cannot be intercepted or stolen [1]'
  },
  {
    icon:'ğŸ›ï¸', text:'Log in to a government portal and submit personal details for a passport application.',
    answer:'https',
    fb:'<strong>HTTPS</strong> is required whenever personal or sensitive data is being transmitted. The SSL layer encrypts the data so it\'s unreadable to anyone who intercepts it mid-transfer.',
    exam:'HTTPS [1] / enables user to safely use the internet [1] / stops data being corrupted/intercepted/stolen [1]'
  },
  {
    icon:'ğŸ”', text:'Log in to your online banking account to check your balance.',
    answer:'https',
    fb:'<strong>HTTPS</strong> is the only suitable protocol for online banking. Without encryption, your username and password would be transmitted as plain text and could be stolen by a hacker on the same network.',
    exam:'HTTPS [1] / uses encryption [1] / data unreadable/meaningless if intercepted [1] / e.g. online banking [1]'
  },
  // FTP missions
  {
    icon:'ğŸ¬', text:'Upload a large video project file to the school\'s web server.',
    answer:'ftp',
    fb:'<strong>FTP</strong> â€” File Transfer Protocol â€” is specifically designed for uploading and downloading files over the internet. It\'s the correct choice for transferring large files to a server.',
    exam:'FTP = File Transfer Protocol [1] / allows users to upload and download files from file servers using the internet [1]'
  },
  {
    icon:'ğŸ’¾', text:'Download a software installation file from a developer\'s FTP server.',
    answer:'ftp',
    fb:'<strong>FTP</strong> is used to send and receive files over the internet. Downloading software from a server is exactly what FTP was designed for.',
    exam:'FTP [1] / used to send and receive files over the internet [1]'
  },
  {
    icon:'ğŸ“‚', text:'Transfer a batch of large image files to a web hosting server.',
    answer:'ftp',
    fb:'<strong>FTP</strong> is correct. When a web developer needs to transfer files to a hosting server, FTP is the standard protocol used. It handles the upload/download of files efficiently.',
    exam:'FTP [1] / File Transfer Protocol [1] / allows users to upload and download files [1]'
  }
];

const routes = [
  { id:'http',  icon:'ğŸŒ', name:'HTTP',  tag:'Web Pages',    col:'#3498db' },
  { id:'https', icon:'ğŸ”’', name:'HTTPS', tag:'Secure / Banking', col:'#2ecc71' },
  { id:'ftp',   icon:'ğŸ“', name:'FTP',   tag:'File Transfer', col:'#00d9ff' }
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let shuffledMissions = [];
let currentMissionIndex = 0;
let score = 0;
let streak = 0;
let bestStreak = 0;
let answered = false;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function shuffle(arr) {
  // Group by protocol so we get a mix, then shuffle within groups
  const http = arr.filter(m=>m.answer==='http');
  const https = arr.filter(m=>m.answer==='https');
  const ftp = arr.filter(m=>m.answer==='ftp');
  const shuffleArr = a => {
    for (let i=a.length-1;i>0;i--) {
      const j=Math.floor(Math.random()*(i+1));
      [a[i],a[j]]=[a[j],a[i]];
    }
    return a;
  };
  // Interleave: pick one from each group cyclically
  const result = [];
  const pools = [shuffleArr(http), shuffleArr(https), shuffleArr(ftp)];
  for (let i=0; i<3; i++) {
    pools.forEach(pool => { if (pool[i]) result.push(pool[i]); });
  }
  return result;
}

function startGame() {
  document.getElementById('welcomeOverlay').style.display = 'none';
  shuffledMissions = shuffle(missions);
  loadMission(0);
  generateStars();
}

function generateStars() {
  const sf = document.getElementById('starfield');
  for (let i=0; i<80; i++) {
    const s = document.createElement('div');
    s.className = 'star';
    const sz = Math.random() > 0.7 ? 2 : 1;
    s.style.cssText = `
      width:${sz}px; height:${sz}px;
      left:${Math.random()*100}%; top:${Math.random()*100}%;
      animation-duration:${2+Math.random()*4}s;
      animation-delay:${Math.random()*4}s;
    `;
    sf.appendChild(s);
  }
}

function loadMission(idx) {
  answered = false;
  currentMissionIndex = idx;
  const m = shuffledMissions[idx];

  document.getElementById('missionNum').textContent = String(idx+1).padStart(2,'0');
  document.getElementById('missionDisplay').textContent = (idx+1)+'/'+shuffledMissions.length;
  document.getElementById('missionIcon').textContent = m.icon;
  document.getElementById('missionText').textContent = m.text;

  // Rebuild briefing card animation
  const bc = document.getElementById('briefingCard');
  bc.style.animation = 'none';
  void bc.offsetWidth; // reflow
  bc.style.animation = '';

  // Build routes
  const grid = document.getElementById('routeGrid');
  grid.innerHTML = '';
  routes.forEach(r => {
    const btn = document.createElement('div');
    btn.className = 'route-btn ' + r.id;
    btn.id = 'route-' + r.id;
    btn.style.cursor = 'pointer';
    btn.innerHTML = `
      <span class="route-icon">${r.icon}</span>
      <div class="route-name ${r.id}">${r.name}</div>
      <div class="route-tag">${r.tag}</div>
    `;
    btn.onclick = () => selectRoute(r.id, m);
    grid.appendChild(btn);
  });

  // Reset feedback & next button
  document.getElementById('feedbackPanel').className = 'feedback-panel';
  document.getElementById('nextMissionBtn').className = 'next-mission-btn';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SELECT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function selectRoute(routeId, mission) {
  if (answered) return;
  answered = true;

  // Disable all routes
  routes.forEach(r => {
    const btn = document.getElementById('route-' + r.id);
    btn.onclick = null;
    btn.style.cursor = 'default';
  });

  const chosenBtn = document.getElementById('route-' + routeId);
  const correctBtn = document.getElementById('route-' + mission.answer);

  if (routeId === mission.answer) {
    // âœ… Correct
    chosenBtn.classList.add('correct-route');
    chosenBtn.style.border = '2px solid #2ecc71';
    chosenBtn.style.background = 'rgba(46,204,113,0.12)';

    score += 100;
    streak++;
    if (streak > bestStreak) bestStreak = streak;

    launchPacket(chosenBtn, 'ğŸ“¦');
    showFeedback(true, mission.fb, mission.exam);
    showFloatScore('+100 pts', true);

    if (streak >= 3) {
      const combo = document.createElement('div');
      combo.className = 'combo-flash';
      combo.textContent = 'ğŸ›°ï¸ LOCKED ON! ' + streak + ' in a row!';
      document.body.appendChild(combo);
      setTimeout(() => combo.remove(), 1200);
    }

    updateSignal();

  } else {
    // âŒ Wrong
    chosenBtn.classList.add('wrong-route');
    chosenBtn.style.border = '2px solid #f85149';
    chosenBtn.style.background = 'rgba(248,81,73,0.1)';
    correctBtn.style.border = '2px solid #2ecc71';
    correctBtn.style.background = 'rgba(46,204,113,0.08)';

    streak = 0;
    showHackerSwoop();
    showFeedback(false, 'âŒ Data intercepted! The correct protocol was <strong>' + routes.find(r=>r.id===mission.answer)?.name + '</strong>. ' + mission.fb, mission.exam);
    showFloatScore('INTERCEPTED! ğŸ‘¾', false);
  }

  updateUI();

  const nextBtn = document.getElementById('nextMissionBtn');
  const isLast = currentMissionIndex >= shuffledMissions.length - 1;
  nextBtn.textContent = isLast ? 'See Results â†’' : 'Next Mission â†’';
  nextBtn.className = 'next-mission-btn visible';
}

function launchPacket(targetBtn, emoji) {
  const rect = targetBtn.getBoundingClientRect();
  const mapRect = document.getElementById('mapSection').getBoundingClientRect();
  const packet = document.createElement('div');
  packet.className = 'data-packet';
  packet.style.left = (rect.left + rect.width/2 - mapRect.left) + 'px';
  packet.style.top = (rect.top + rect.height/2 - mapRect.top) + 'px';
  packet.textContent = emoji;
  document.getElementById('packetLayer').appendChild(packet);
  setTimeout(() => packet.remove(), 1300);
}

function showHackerSwoop() {
  const h = document.createElement('div');
  h.className = 'hacker-swoop';
  h.textContent = 'ğŸ‘¾';
  h.style.left = (window.innerWidth * 0.7) + 'px';
  h.style.top = (window.innerHeight * 0.3) + 'px';
  document.body.appendChild(h);
  setTimeout(() => h.remove(), 900);
}

function showFeedback(correct, text, exam) {
  const panel = document.getElementById('feedbackPanel');
  const title = document.getElementById('fpTitle');
  const textEl = document.getElementById('fpText');

  panel.className = 'feedback-panel visible ' + (correct ? 'correct' : 'wrong');
  title.textContent = correct ? 'âœ… Packet delivered successfully!' : 'âŒ Data intercepted!';
  textEl.innerHTML = text + '<br><div class="exam-chip">ğŸ“š ' + exam + '</div>';
}

function nextMission() {
  currentMissionIndex++;
  if (currentMissionIndex >= shuffledMissions.length) {
    showResults();
  } else {
    loadMission(currentMissionIndex);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  RESULTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showResults() {
  let rankIcon, rankName, sub;
  if (score >= 800) { rankIcon='ğŸ…'; rankName='COMMS DIRECTOR'; sub='Perfect routing! You selected the right protocol every time. Outstanding knowledge.'; }
  else if (score >= 600) { rankIcon='ğŸ“¡'; rankName='SENIOR COMMS OFFICER'; sub='Excellent work! Just a couple of protocols caught you out â€” review the summary below.'; }
  else if (score >= 400) { rankIcon='ğŸ›°ï¸'; rankName='COMMS OFFICER'; sub='Good understanding overall! A few missions went wrong â€” check the protocol definitions below.'; }
  else { rankIcon='ğŸ“‹'; rankName='COMMS CADET'; sub='Protocols can be tricky! Study the definitions below carefully and try again.'; }

  document.getElementById('rankIcon').textContent = rankIcon;
  document.getElementById('rankName').textContent = rankName;
  document.getElementById('resScore').innerHTML = score + ' <span>pts</span>';
  document.getElementById('resSub').textContent = sub;
  document.getElementById('resultsOverlay').className = 'results-overlay visible';

  if (score >= 700) spawnConfetti(50);
}

function restartGame() {
  score=0; streak=0; bestStreak=0; currentMissionIndex=0; answered=false;
  document.getElementById('resultsOverlay').className = 'results-overlay';
  document.getElementById('welcomeOverlay').style.display = 'flex';
  updateUI();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  UI HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateUI() {
  document.getElementById('scoreDisplay').textContent = score;
}

function updateSignal() {
  const pct = Math.min(100, (score / 900) * 100);
  document.getElementById('signalFill').style.width = pct + '%';
}

function showFloatScore(text, positive) {
  const el = document.createElement('div');
  el.className = 'float-score';
  el.style.color = positive ? '#2ecc71' : '#f85149';
  el.style.left = (window.innerWidth/2 - 50) + 'px';
  el.style.top = (window.innerHeight*0.35) + 'px';
  el.textContent = text;
  document.body.appendChild(el);
  setTimeout(() => el.remove(), 1100);
}

function spawnConfetti(count) {
  const colours = ['#2ecc71','#1a8a4a','#00d9ff','#e3b341','#ffffff','#3498db'];
  for (let i=0; i<count; i++) {
    const c = document.createElement('div');
    c.style.cssText = `
      position:fixed; width:10px; height:10px;
      background:${colours[Math.floor(Math.random()*colours.length)]};
      top:-10px; left:${Math.random()*100}vw;
      border-radius:${Math.random()>0.5?'50%':'2px'};
      pointer-events:none; z-index:9999;
      animation:confFall ${1.5+Math.random()*2}s linear ${Math.random()*0.5}s forwards;
    `;
    document.body.appendChild(c);
    setTimeout(() => c.remove(), 3500);
  }
}

const style = document.createElement('style');
style.textContent = `@keyframes confFall { 0%{transform:translateY(0) rotate(0deg);opacity:1} 100%{transform:translateY(100vh) rotate(720deg);opacity:0} }`;
document.head.appendChild(style);
</script>
</body>
</html>
